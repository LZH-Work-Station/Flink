# 窗口分配器

## 参考资料：十分全 https://www.jianshu.com/p/a883262241ef

窗口分配器是将数据依据不同类型的窗口组成不同的数据流，然后对每个数据流做reduce操作。分配器主要有两种：时间窗口和计数窗口

## 时间窗口

- 滚动窗口。窗口之间没有交集

![image-20210716125613112](D:\Tutorial\Flink\Blog\窗口\image\image-20210716125613112.png)

```java
DataStream<Tuple2<String, Double>> minTempPerWindowStream = dataStream 
  .map(new MapFunction<SensorReading, Tuple2<String, Double>>() { 
    @Override 
    public Tuple2<String, Double> map(SensorReading value) throws Exception {
      return new Tuple2<>(value.getId(), value.gStTemperature()); 
    } 
  }) 
  .keyBy(data -> data.f0) 
  .window( TumblingEventTimeWindows.of(Time.seconds(5) ) 
  .minBy(1);
```

- 滑动窗口 窗口有交集

![image-20210716125642074](D:\Tutorial\Flink\Blog\窗口\image\image-20210716125642074.png)

```java
DataStream<SensorReading> minTempPerWindowStream = dataStream 
  .keyBy(SensorReading::getId) 
  .window( SlidingEventTimeWindows.of(Time.seconds(10), Time.seconds(5)) )  // 前面是窗口大小，后面是步长
  .minBy("temperature");
```

## 计数窗口

- 滚动窗口

```java
DataStream<SensorReading> minTempPerWindowStream = dataStream 
  .keyBy(SensorReading::getId) 
  .countWindow( 5 ) 
  .minBy("temperature");
```

- 滑动窗口

```java
DataStream<SensorReading> minTempPerWindowStream = dataStream 
  .keyBy(SensorReading::getId) 
  .countWindow( 10, 2 ) 
  .minBy("temperature");
```

## 会话窗口

```java
input
    .keyBy(<key selector>)
    .window(EventTimeSessionWindows.withGap(Time.minutes(10)))
    .<windowed transformation>(<window function>);
```

